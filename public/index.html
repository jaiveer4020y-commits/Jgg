<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CINEMA TITAN V21.0 | GOLIATH BUILD</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <link rel="stylesheet" href="https://unpkg.com/artplayer@5.1.1/dist/artplayer.css">
    <script src="https://unpkg.com/hls.js@1.5.17/dist/hls.min.js"></script>
    <script src="https://unpkg.com/artplayer@5.1.1/dist/artplayer.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Outfit:wght@700;900&display=swap" rel="stylesheet">

    <style>
        /* ================================================================
        1. GOLIATH CORE STYLING
        ================================================================ */
        :root {
            --n-red: #E50914;
            --n-black: #050505;
            --sub-size: 28px;
            --sub-color: #ffffff;
        }

        body, html {
            margin: 0; padding: 0; width: 100vw; height: 100vh;
            background-color: #000; color: #fff;
            font-family: 'Inter', sans-serif; overflow: hidden;
            user-select: none; -webkit-tap-highlight-color: transparent;
        }

        /* DASHBOARD - THE TERMINAL */
        #titan-terminal {
            position: fixed; inset: 0; z-index: 500;
            background: radial-gradient(circle at center, #220707 0%, #000 100%);
            display: flex; align-items: center; justify-content: center;
            transition: transform 1s cubic-bezier(0.7, 0, 0.3, 1), opacity 0.5s;
        }

        .terminal-inactive { transform: translateY(-100%); opacity: 0; pointer-events: none; }

        .goliath-card {
            width: 90%; max-width: 550px; padding: 45px;
            background: rgba(15, 15, 15, 0.98); border-radius: 35px;
            border: 1px solid rgba(255,255,255,0.08);
            box-shadow: 0 50px 100px rgba(0,0,0,0.9);
            text-align: center;
        }

        .goliath-brand {
            font-family: 'Outfit', sans-serif; font-size: 2.8rem; font-weight: 900;
            color: var(--n-red); margin-bottom: 35px; text-transform: uppercase;
            letter-spacing: -1px; text-shadow: 0 0 15px rgba(229, 9, 20, 0.4);
        }

        .q-input-wrap { margin-bottom: 25px; text-align: left; }
        .q-input-wrap label { display: block; font-size: 11px; font-weight: 800; color: #666; text-transform: uppercase; margin-bottom: 10px; letter-spacing: 2px; }

        .titan-input {
            width: 100%; padding: 20px; background: #000; border: 1px solid #222;
            border-radius: 18px; color: #fff; font-size: 16px; transition: 0.3s;
        }
        .titan-input:focus { border-color: var(--n-red); box-shadow: 0 0 15px rgba(229,9,20,0.2); outline: none; }

        .titan-btn-init {
            width: 100%; padding: 22px; background: var(--n-red); color: #fff;
            border: none; border-radius: 18px; font-weight: 900; font-size: 17px;
            text-transform: uppercase; letter-spacing: 3px; cursor: pointer;
            transition: 0.4s; box-shadow: 0 15px 30px rgba(229,9,20,0.3);
        }
        .titan-btn-init:hover { transform: scale(1.02); filter: brightness(1.2); }

        /* ================================================================
        2. OFFICIAL NETFLIX SPINNER SYSTEM
        ================================================================ */
        @keyframes netflix-rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        #loading-veil {
            position: fixed; inset: 0; z-index: 1000; background: #000;
            display: none; align-items: center; justify-content: center;
        }

        #backdrop-blur {
            position: absolute; inset: 0; width: 100%; height: 100%;
            object-fit: cover; opacity: 0.4; filter: brightness(0.6);
        }

        /* ================================================================
        3. ARTPLAYER GOLIATH VIEWPORT
        ================================================================ */
        #goliath-viewport { position: fixed; inset: 0; background: #000; z-index: 1500; display: none; }

        .btn-close-viewport {
            position: absolute; top: 40px; left: 40px; z-index: 3000;
            cursor: pointer; background: rgba(0,0,0,0.6); padding: 15px;
            border-radius: 50%; transition: 0.3s;
        }
        .btn-close-viewport:hover { background: var(--n-red); transform: rotate(-90deg); }

        /* MANUAL SUBTITLE MATRIX (THE "LOCK-STYLE" LAYER) */
        .goliath-subtitle-matrix {
            position: absolute; bottom: 12%; left: 0; right: 0;
            display: flex; justify-content: center; pointer-events: none;
            z-index: 2500; text-align: center; padding: 0 10%;
        }

        #goliath-sub-render {
            background: rgba(0, 0, 0, 0.8);
            color: var(--sub-color);
            font-size: var(--sub-size);
            padding: 8px 18px;
            border-radius: 10px;
            font-weight: 600;
            line-height: 1.4;
            display: none;
            text-shadow: 0 2px 10px rgba(0,0,0,0.9);
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        /* CENTER ICONS SYSTEM */
        .mobileCenterControls_playerControlsInnerContainer__6MCmU {
            position: absolute; inset: 0; display: flex; align-items: center;
            justify-content: center; gap: 15vw; pointer-events: none;
            opacity: 0; transition: opacity 0.4s; z-index: 150;
        }
        .art-hover .mobileCenterControls_playerControlsInnerContainer__6MCmU,
        .art-state-paused .mobileCenterControls_playerControlsInnerContainer__6MCmU { opacity: 1; }

        /* MANDATORY HIDE ON LOADING */
        .art-state-loading .mobileCenterControls_playerControlsInnerContainer__6MCmU {
            display: none !important;
        }

        .icon-titan-old {
            background: transparent !important; border: none; width: 65px; height: 65px;
            color: #fff; cursor: pointer; pointer-events: auto; transition: 0.2s;
            filter: drop-shadow(0 0 15px rgba(0,0,0,0.5));
        }
        .icon-titan-old:hover { transform: scale(1.2); color: var(--n-red); }

    </style>
</head>
<body>

<div id="titan-terminal">
    <div class="goliath-card">
        <div class="goliath-brand">Goliath Cinema</div>
        
        <div class="q-input-wrap">
            <label>Neuro-Search Uplink</label>
            <input type="text" id="target-title" class="titan-input" placeholder="Enter Movie or Show Name...">
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
            <div class="q-input-wrap">
                <label>Season</label>
                <input type="number" id="s-num" class="titan-input" value="1">
            </div>
            <div class="q-input-wrap">
                <label>Episode</label>
                <input type="number" id="e-num" class="titan-input" value="1">
            </div>
        </div>

        <button class="titan-btn-init" onclick="igniteGoliath()">Initiate Protocol</button>
    </div>
</div>

<div id="loading-veil">
    <img id="backdrop-blur" src="">
    <img src="https://assets.nflxext.com/en_us/pages/wiplayer/site-spinner.png" style="width:80px; z-index:10; animation: netflix-rotate 1.2s linear infinite;">
</div>

<div id="goliath-viewport">
    <div class="btn-close-viewport" onclick="terminateGoliath()">
        <svg viewBox="0 0 24 24" width="32" height="32" fill="white"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
    </div>

    <div class="goliath-subtitle-matrix">
        <div id="goliath-sub-render"></div>
    </div>

    <div id="art-canvas" style="width:100%; height:100%;"></div>
</div>

<script>
/**
 * CINEMA TITAN V21.0 - GOLIATH BUILD
 * Features: Absolute Audio Switching, Manual Layer Subs, Netflix Spinner Only.
 */

const GOLIATH = {
    PROXY: (u) => `https://workingg.vercel.app/api/proxy?url=${encodeURIComponent(u)}`,
    TMDB: '463dcd7993ab31d92eb586802fdeee6a',
    MEDIA: { id: null, type: 'tv', title: '', year: '' },
    PLAYER: null,
    HLS: null,
    SUBS: []
};

async function igniteGoliath() {
    const q = document.getElementById('target-title').value;
    if(!q) return alert("Alert: Target title required.");

    const veil = document.getElementById('loading-veil');
    veil.style.display = 'flex';

    try {
        // 1. Data Recovery
        const r = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${GOLIATH.TMDB}&query=${encodeURIComponent(q)}`).then(res=>res.json());
        const data = r.results[0];
        GOLIATH.MEDIA.id = data.id;
        GOLIATH.MEDIA.type = data.media_type || 'tv';
        GOLIATH.MEDIA.title = data.title || data.name;
        GOLIATH.MEDIA.year = (data.release_date || data.first_air_date || '').split('-')[0];

        if(data.backdrop_path) document.getElementById('backdrop-blur').src = `https://image.tmdb.org/t/p/original${data.backdrop_path}`;

        const s = document.getElementById('s-num').value;
        const e = document.getElementById('e-num').value;
        const slug = `${GOLIATH.MEDIA.title.toLowerCase().replace(/[^a-z0-9]/g,'.')}.${GOLIATH.MEDIA.type === 'tv' ? `s${s.padStart(2,'0')}e${e.padStart(2,'0')}` : GOLIATH.MEDIA.year}`;

        // 2. Subtitle Mapping (Fixed URL)
        try {
            let subUrl = `https://sub.wyzie.ru/search?id=${GOLIATH.MEDIA.id}`;
            if(GOLIATH.MEDIA.type === 'tv') subUrl += `&season=${s}&episode=${e}`;
            
            const subRes = await fetch(GOLIATH.PROXY(subUrl)).then(res => res.json());
            if(Array.isArray(subRes)) {
                GOLIATH.SUBS = subRes.map(i => ({ html: i.lang || 'Subtitle', url: GOLIATH.PROXY(i.url) }));
            }
        } catch(e) {}

        // 3. Stream Link Initialization
        const api = `https://u-1-1azw.onrender.com/api/get-stream?title=${encodeURIComponent(slug)}&id=${GOLIATH.MEDIA.id}&season=${s}&episode=${e}`;
        const streamData = await fetch(GOLIATH.PROXY(api)).then(res => res.json());
        
        if(streamData.m3u8_url) {
            bootGoliathPlayer(GOLIATH.PROXY(streamData.m3u8_url));
        } else {
            alert("Goliath: Channel Unavailable.");
            veil.style.display = 'none';
        }
    } catch(err) {
        veil.style.display = 'none';
        alert("Goliath: Fatal Protocol Crash.");
    }
}

function bootGoliathPlayer(url) {
    document.getElementById('goliath-viewport').style.display = 'block';
    document.getElementById('loading-veil').style.display = 'none';
    document.getElementById('titan-terminal').classList.add('terminal-inactive');

    if(GOLIATH.PLAYER) GOLIATH.PLAYER.destroy();

    GOLIATH.PLAYER = new Artplayer({
        container: '#art-canvas',
        url: url,
        type: 'm3u8',
        autoplay: true,
        fullscreen: true,
        setting: true,
        theme: '#E50914',
        // THE ONLY SPINNER REQUESTED
        icons: {
            loading: '<img src="https://assets.nflxext.com/en_us/pages/wiplayer/site-spinner.png" style="width:75px; animation: netflix-rotate 1.2s linear infinite;">',
        },
        layers: [
            {
                name: 'goliath-controls',
                html: `
                    <div class="mobileCenterControls_playerControlsInnerContainer__6MCmU">
                        <button class="icon-titan-old" onclick="GOLIATH.PLAYER.backward=10">
                            <svg viewBox="0 0 24 24" width="45" fill="white"><path d="M12.5 3c-4.97 0-9 4.03-9 9H1l4 4 4-4H6.5c0-3.03 2.47-5.5 5.5-5.5s5.5 2.47 5.5 5.5-2.47 5.5-5.5 5.5c-1.51 0-2.88-.61-3.88-1.59l-1.42 1.43C8.16 18.31 9.98 19 12 19c4.97 0 9-4.03 9-9s-4.03-9-9-9z"/></svg>
                        </button>
                        <button id="GoliathCenterBtn" class="icon-titan-old" style="width:100px; height:100px;" onclick="GOLIATH.PLAYER.toggle()">
                            <svg viewBox="0 0 24 24" width="75" fill="white"><path d="M8 5v14l11-7z"/></svg>
                        </button>
                        <button class="icon-titan-old" onclick="GOLIATH.PLAYER.forward=10">
                            <svg viewBox="0 0 24 24" width="45" fill="white"><path d="M11.5 3c4.97 0 9 4.03 9 9h2.5l-4 4-4-4H17.5c0-3.03-2.47-5.5-5.5-5.5s-5.5 2.47-5.5 5.5 2.47 5.5 5.5 5.5c1.51 0 2.88-.61 3.88-1.59l1.42 1.43C15.84 18.31 14.02 19 12 19c-4.97 0-9-4.03-9-9s4.03-9 9-9z"/></svg>
                        </button>
                    </div>
                `
            }
        ],
        customType: {
            m3u8: function(video, url) {
                if (Hls.isSupported()) {
                    const hls = new Hls();
                    hls.loadSource(url);
                    hls.attachMedia(video);
                    GOLIATH.HLS = hls;

                    hls.on(Hls.Events.MANIFEST_PARSED, () => {
                        // 1. DYNAMIC AUDIO SWITCHER FIX
                        if(hls.audioTracks.length > 0) {
                            GOLIATH.PLAYER.setting.add({
                                name: 'audio-tracks',
                                html: 'Audio Selection',
                                selector: hls.audioTracks.map((t, i) => ({
                                    html: t.name || t.lang || `Track ${i+1}`,
                                    index: i,
                                    default: i === hls.audioTrack
                                })),
                                onSelect: (item) => {
                                    hls.audioTrack = item.index;
                                    return item.html;
                                }
                            });
                        }

                        // 2. SUBTITLE SELECTOR
                        GOLIATH.PLAYER.setting.add({
                            name: 'goliath-subs',
                            html: 'Subtitles',
                            selector: [{html: 'Off', url: '', default: true}, ...GOLIATH.SUBS],
                            onSelect: (item) => {
                                if(item.url) {
                                    GOLIATH.PLAYER.subtitle.url = item.url;
                                    GOLIATH.PLAYER.subtitle.show = true;
                                    forceAppleTrack(item.url, item.html);
                                } else {
                                    GOLIATH.PLAYER.subtitle.show = false;
                                    document.getElementById('goliath-sub-render').style.display = 'none';
                                }
                                return item.html;
                            }
                        });

                        // 3. MANUAL SUBTITLE STYLING
                        GOLIATH.PLAYER.setting.add({
                            name: 'sub-style',
                            html: 'Subtitle Matrix Style',
                            selector: [
                                {html: 'Small / Yellow', size: '20px', color: '#ffea00'},
                                {html: 'Medium / White', size: '28px', color: '#fff', default: true},
                                {html: 'Large / White', size: '38px', color: '#fff'}
                            ],
                            onSelect: (item) => {
                                const el = document.getElementById('goliath-sub-render');
                                el.style.fontSize = item.size;
                                el.style.color = item.color;
                                return item.html;
                            }
                        });
                    });
                }
            }
        }
    });

    // THE GOLIATH MANUAL RENDERER (ELIMINATES NULL ERRORS)
    GOLIATH.PLAYER.on('subtitleUpdate', (text) => {
        const matrix = document.getElementById('goliath-sub-render');
        if(text) {
            matrix.innerHTML = text;
            matrix.style.display = 'inline-block';
        } else {
            matrix.style.display = 'none';
        }
    });

    // ICON SYNC
    GOLIATH.PLAYER.on('play', () => {
        document.querySelector('#GoliathCenterBtn').innerHTML = '<svg viewBox="0 0 24 24" width="75" fill="white"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';
    });
    GOLIATH.PLAYER.on('pause', () => {
        document.querySelector('#GoliathCenterBtn').innerHTML = '<svg viewBox="0 0 24 24" width="75" fill="white"><path d="M8 5v14l11-7z"/></svg>';
    });
}

function forceAppleTrack(url, label) {
    const v = document.querySelector('video');
    if(!v) return;
    const old = v.querySelectorAll('track');
    old.forEach(t => t.remove());
    const track = document.createElement('track');
    track.kind = 'subtitles';
    track.label = label;
    track.src = url;
    track.default = true;
    v.appendChild(track);
}

function terminateGoliath() {
    if(GOLIATH.PLAYER) GOLIATH.PLAYER.destroy();
    if(GOLIATH.HLS) GOLIATH.HLS.destroy();
    document.getElementById('goliath-viewport').style.display = 'none';
    document.getElementById('titan-terminal').classList.remove('terminal-inactive');
    document.getElementById('goliath-sub-render').style.display = 'none';
}

</script>
</body>
</html>
