<!DOCTYPE html>
<html lang="en">
<head>
    <title>Netflix UI - Pro Advanced Features</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <style>
        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: #000;
            margin: 0;
            padding: 0;
        }

        .artplayer-app {
            width: 100%;
            max-width: 100%;
            height: 100%;
            margin: 0px auto;
            background: #000;
            position: relative;
        }

        .netflix-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px;
            z-index: 20;
            display: flex;
            align-items: center;
            gap: 12px;
            pointer-events: none;
        }

        .movie-title {
            color: #fff;
            font-size: 18px;
            font-weight: 500;
        }

        .netflix-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 100px;
            z-index: 10;
            pointer-events: none;
            opacity: 0;
            transition: opacity .3s;
        }

        .art-state-show .netflix-overlay {
            opacity: 1;
        }

        .netflix-btn {
            pointer-events: auto;
            cursor: pointer;
        }

        .netflix-btn svg {
            width: 55px;
            height: 55px;
            fill: #FFFFFF;
        }

        .netflix-btn.play-center svg {
            width: 90px;
            height: 90px;
        }

        .art-subtitle {
            font-size: 22px !important;
            background: rgba(0,0,0,.6) !important;
            padding: 4px 10px;
            border-radius: 2px;
        }

        .status {
            color: #0f0;
            text-align: center;
            font-size: 13px;
            margin-top: 10px;
        }
    </style>
</head>

<body>

<div class="artplayer-app">
    <div class="netflix-header">
        <div class="movie-title" id="movieTitle">Loadingâ€¦</div>
    </div>
</div>

<div class="status" id="status">Initializingâ€¦</div>

<script src="https://cdn.jsdelivr.net/npm/@swarmcloud/hls/hls.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/artplayer@5.0.9/dist/artplayer.js"></script>

<script>
(async () => {
    const status = msg => {
        document.getElementById('status').innerText = msg;
        console.log(msg);
    };

    const params = new URLSearchParams(window.location.search);
    const title = params.get('title');

    if (!title) {
        status('No title in URL');
        return;
    }

    document.getElementById('movieTitle').innerText = title;

    // ðŸ”¥ USE PROXY FOR RENDER API (CORS FIX)
    const renderApi =
        'https://workingg.vercel.app/api/proxy?url=' +
        encodeURIComponent(
            `https://u-1-1azw.onrender.com/api/get-stream?title=${title}`
        );

    status('Fetching stream infoâ€¦');

    let json;
    try {
        const res = await fetch(renderApi);
        json = await res.json();
    } catch (e) {
        status('Render API failed');
        return;
    }

    if (!json.m3u8_url) {
        status('Stream not found');
        return;
    }

    // ðŸ”¥ USE PROXY FOR M3U8
    const finalM3U8 =
        'https://workingg.vercel.app/api/proxy?url=' +
        encodeURIComponent(json.m3u8_url);

    status('Starting playerâ€¦');

    const iconPlay = `<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>`;
    const iconPause = `<svg viewBox="0 0 24 24"><path d="M6 19h4V5H6zm8-14v14h4V5z"/></svg>`;
    const iconBack = `<svg viewBox="0 0 24 24"><path d="M12 5v14l-8-7z"/></svg>`;
    const iconForward = `<svg viewBox="0 0 24 24"><path d="M12 5l8 7-8 7z"/></svg>`;

    const art = new Artplayer({
        container: '.artplayer-app',
        url: finalM3U8,
        type: 'm3u8',
        setting: true,
        playbackRate: true,
        aspectRatio: true,
        fullscreen: true,
        fullscreenWeb: true,
        autoSize: true,
        airplay: true,
        pip: true,
        screenshot: true,
        subtitleOffset: true,
        miniProgressBar: true,
        mutex: true,
        backdrop: true,
        playsInline: true,
        theme: '#e50914',

        layers: [{
            name: 'netflix-overlay',
            html: `
                <div class="netflix-overlay">
                    <div class="netflix-btn back-10">${iconBack}</div>
                    <div class="netflix-btn play-center">${iconPlay}</div>
                    <div class="netflix-btn forward-10">${iconForward}</div>
                </div>
            `
        }],

        customType: {
            m3u8(video, url, art) {
                if (Hls.isSupported()) {
                    const hls = new Hls();
                    hls.loadSource(url);
                    hls.attachMedia(video);
                    art.hls = hls;

                    hls.on(Hls.Events.MANIFEST_PARSED, () => {
                        art.setting.add({
                            name: 'quality',
                            html: 'Quality',
                            selector: [
                                { html: 'Auto', level: -1, default: true },
                                ...hls.levels.map((l, i) => ({
                                    html: l.height + 'p',
                                    level: i
                                }))
                            ],
                            onSelect: item => {
                                hls.currentLevel = item.level;
                                return item.html;
                            }
                        });
                    });

                    hls.on(Hls.Events.AUDIO_TRACKS_UPDATED, (_, data) => {
                        if (data.audioTracks.length > 1) {
                            art.setting.add({
                                name: 'audio',
                                html: 'Audio',
                                selector: data.audioTracks.map((t, i) => ({
                                    html: t.name || t.lang || `Track ${i}`,
                                    index: i,
                                    default: i === hls.audioTrack
                                })),
                                onSelect: item => {
                                    hls.audioTrack = item.index;
                                    return item.html;
                                }
                            });
                        }
                    });
                }
            }
        }
    });

    art.on('ready', () => {
        status('Ready');

        const playBtn = document.querySelector('.play-center');
        const backBtn = document.querySelector('.back-10');
        const forwardBtn = document.querySelector('.forward-10');

        playBtn.onclick = () => art.toggle();
        backBtn.onclick = () => art.seek = art.currentTime - 10;
        forwardBtn.onclick = () => art.seek = art.currentTime + 10;

        art.on('play', () => playBtn.innerHTML = iconPause);
        art.on('pause', () => playBtn.innerHTML = iconPlay);
    });
})();
</script>

</body>
</html>
