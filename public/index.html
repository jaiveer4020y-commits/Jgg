<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Netflix Pro Elite | Global Streaming Engine v7.0</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://unpkg.com/artplayer@5.3.0/dist/artplayer.css">
    <script src="https://unpkg.com/hls.js@1.5.17/dist/hls.min.js"></script>
    <script src="https://unpkg.com/artplayer@5.3.0/dist/artplayer.js"></script>

    <style>
        /* ============================================================
           PREMIUM CSS ARCHITECTURE 
        ============================================================ */
        :root {
            --netflix-red: #e50914;
            --netflix-black: #000000;
            --netflix-dark: #141414;
            --netflix-gray: #2f2f2f;
            --text-main: #ffffff;
            --text-dim: #b3b3b3;
            --transition-smooth: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: var(--netflix-black);
            color: var(--text-main);
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            overflow-x: hidden;
        }

        /* ----- SEARCH DASHBOARD ----- */
        #dashboard-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 60px 20px;
            transition: var(--transition-smooth);
            z-index: 10;
        }

        .header-section {
            text-align: center;
            margin-bottom: 50px;
            width: 100%;
            max-width: 800px;
        }

        .header-section h1 {
            color: var(--netflix-red);
            font-size: 4rem;
            font-weight: 900;
            margin: 0;
            letter-spacing: -2px;
            text-transform: uppercase;
        }

        .header-section p {
            color: var(--text-dim);
            font-size: 1.1rem;
            margin-top: 5px;
        }

        .search-engine {
            width: 100%;
            max-width: 700px;
            position: relative;
            margin-bottom: 40px;
        }

        .search-engine input {
            width: 100%;
            padding: 20px 30px;
            background: var(--netflix-dark);
            border: 1px solid #333;
            border-radius: 50px;
            color: white;
            font-size: 1.2rem;
            outline: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transition: var(--transition-smooth);
        }

        .search-engine input:focus {
            border-color: var(--netflix-red);
            background: #1f1f1f;
            box-shadow: 0 0 15px rgba(229, 9, 20, 0.3);
        }

        /* ----- RESULTS GRID ----- */
        #results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 25px;
            width: 100%;
            max-width: 1200px;
        }

        .movie-card {
            background: var(--netflix-dark);
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: var(--transition-smooth);
            border: 1px solid transparent;
            position: relative;
        }

        .movie-card:hover {
            transform: translateY(-10px) scale(1.05);
            border-color: var(--netflix-red);
            z-index: 5;
        }

        .movie-card img {
            width: 100%;
            aspect-ratio: 2/3;
            object-fit: cover;
        }

        .card-meta {
            padding: 12px;
            font-size: 0.9rem;
        }

        .card-meta b {
            display: block;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .card-type-tag {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: bold;
            color: var(--netflix-red);
        }

        /* ----- MODAL FOR TV SERIES SELECTION ----- */
        #tv-modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .modal-content {
            background: var(--netflix-dark);
            padding: 40px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            border: 1px solid #444;
        }

        .modal-content h3 { margin-top: 0; color: var(--netflix-red); }

        .input-row {
            display: flex;
            gap: 15px;
            margin: 20px 0;
        }

        .input-box { flex: 1; text-align: left; }
        .input-box label { display: block; font-size: 0.8rem; color: #888; margin-bottom: 5px; }
        .input-box input {
            width: 100%;
            padding: 12px;
            background: #000;
            border: 1px solid #444;
            color: white;
            border-radius: 4px;
        }

        .modal-btns { display: flex; gap: 10px; }
        .btn-confirm { flex: 2; background: var(--netflix-red); color: white; border: none; padding: 12px; border-radius: 4px; font-weight: bold; cursor: pointer; }
        .btn-cancel { flex: 1; background: #333; color: white; border: none; padding: 12px; border-radius: 4px; cursor: pointer; }

        /* ----- OG LOADING LAYER ----- */
        #loading-overlay {
            position: fixed;
            inset: 0;
            background: #000 no-repeat center center;
            background-size: cover;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 15000;
        }

        #loading-overlay::before {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle, rgba(0,0,0,0.4) 0%, rgba(0,0,0,1) 100%);
        }

        .loading-content {
            position: relative;
            z-index: 1;
            text-align: center;
        }

        .og-spinner {
            width: 100px;
            height: 100px;
            animation: rotate-spinner 1.1s linear infinite;
        }

        @keyframes rotate-spinner {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 25px;
            font-size: 1.2rem;
            letter-spacing: 4px;
            font-weight: bold;
            text-shadow: 0 2px 10px rgba(0,0,0,0.9);
        }

        /* ----- PLAYER VIEWPORT ----- */
        #player-wrapper {
            position: fixed;
            inset: 0;
            background: #000;
            display: none;
            z-index: 20000;
        }

        #artplayer { width: 100%; height: 100%; }

        /* ----- CENTER CONTROLS ----- */
        .center-ui {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 100px;
            z-index: 100;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .art-state-show .center-ui { opacity: 1; }

        .center-action {
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.2);
            width: 90px;
            height: 90px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            pointer-events: auto;
            transition: transform 0.2s;
        }

        .center-action:active { transform: scale(0.9); }
        .center-action svg { width: 45px; height: 45px; fill: #fff; }

        /* ----- SUBTITLES ----- */
        .custom-subs {
            position: absolute;
            bottom: 10%;
            left: 0;
            right: 0;
            text-align: center;
            pointer-events: none;
            z-index: 150;
        }

        #sub-display {
            background: rgba(0,0,0,0.75);
            padding: 5px 20px;
            border-radius: 4px;
            font-size: 28px;
            color: white;
            display: none;
            margin: 0 auto;
            max-width: 80%;
            line-height: 1.4;
            text-shadow: 0 2px 4px #000;
        }
    </style>
</head>
<body>

    <div id="dashboard-container">
        <div class="header-section">
            <h1>NETFLIX</h1>
            <p>Premium Cinematic Experience v7.0</p>
        </div>

        <div class="search-engine">
            <input type="text" id="main-search" placeholder="Enter Movie or TV Series name..." onkeydown="if(event.key==='Enter') searchEngine()">
        </div>

        <div id="results-grid">
            </div>
    </div>

    <div id="tv-modal">
        <div class="modal-content">
            <h3 id="modal-title">Select Episode</h3>
            <div class="input-row">
                <div class="input-box">
                    <label>SEASON</label>
                    <input type="number" id="tv-s" value="1" min="1">
                </div>
                <div class="input-box">
                    <label>EPISODE</label>
                    <input type="number" id="tv-e" value="1" min="1">
                </div>
            </div>
            <div class="modal-btns">
                <button class="btn-confirm" onclick="confirmTvPlay()">WATCH NOW</button>
                <button class="btn-cancel" onclick="closeTvModal()">CANCEL</button>
            </div>
        </div>
    </div>

    <div id="loading-overlay">
        <div class="loading-content">
            <img class="og-spinner" src="https://assets.nflxext.com/en_us/pages/wiplayer/site-spinner.png">
            <div class="loading-text" id="status-text">PREPARING...</div>
        </div>
    </div>

    <div id="player-wrapper">
        <div id="artplayer"></div>
        
        <div class="center-ui">
            <div class="center-action" onclick="art.backward = 10">
                <svg viewBox="0 0 24 24"><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>
            </div>
            <div class="center-action" onclick="art.toggle()">
                <svg id="c-play" style="display:none" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                <svg id="c-pause" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
            </div>
            <div class="center-action" onclick="art.forward = 10">
                <svg viewBox="0 0 24 24"><path d="M6 13c0-3.31 2.69-6 6-6v4l5-5-5-5v4c-4.42 0-8 3.58-8 8s3.58 8 8 8 8-3.58 8-8h-2z"/></svg>
            </div>
        </div>

        <div class="custom-subs"><div id="sub-display"></div></div>
    </div>

<script>
/* ============================================================
   SYSTEM CORE 
============================================================ */
const TMDB_KEY = '463dcd7993ab31d92eb586802fdeee6a';
const PROXY = (u) => 'https://workingg.vercel.app/api/proxy?url=' + encodeURIComponent(u);

let art;
let activeItem = null;
let subtitleCues = [];
let activeCue = null;

/** 1. Search Engine Logic **/
async function searchEngine() {
    const query = document.getElementById('main-search').value;
    if(!query) return;

    const res = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${TMDB_KEY}&query=${encodeURIComponent(query)}`);
    const data = await res.json();
    const grid = document.getElementById('results-grid');
    grid.innerHTML = "";

    data.results.forEach(item => {
        if(!item.poster_path) return;
        const type = item.media_type || (item.title ? 'movie' : 'tv');
        
        const card = document.createElement('div');
        card.className = 'movie-card';
        card.innerHTML = `
            <div class="card-type-tag">${type.toUpperCase()}</div>
            <img src="https://image.tmdb.org/t/p/w300${item.poster_path}">
            <div class="card-meta">
                <b>${item.title || item.name}</b>
                <span style="color:#777">${(item.release_date || item.first_air_date || "").split('-')[0]}</span>
            </div>
        `;
        card.onclick = () => handleItemClick(item, type);
        grid.appendChild(card);
    });
}

/** 2. Selection Handling **/
function handleItemClick(item, type) {
    activeItem = item;
    if(type === 'tv') {
        document.getElementById('modal-title').innerText = item.name;
        document.getElementById('tv-modal').style.display = 'flex';
    } else {
        startStreamFlow('movie', item.id, item.title, 0, 0);
    }
}

function closeTvModal() { document.getElementById('tv-modal').style.display = 'none'; }

function confirmTvPlay() {
    const s = document.getElementById('tv-s').value;
    const e = document.getElementById('tv-e').value;
    closeTvModal();
    startStreamFlow('tv', activeItem.id, activeItem.name, s, e);
}

/** 3. Streaming Engine **/
async function startStreamFlow(type, id, title, s, e) {
    const loader = document.getElementById('loading-overlay');
    const status = document.getElementById('status-text');
    
    loader.style.display = 'flex';
    status.innerText = "LOCATING ENGINE...";

    // Dynamic Backdrop
    if(activeItem && activeItem.backdrop_path) {
        loader.style.backgroundImage = `url(https://image.tmdb.org/t/p/original${activeItem.backdrop_path})`;
    }

    try {
        // Fetch Stream
        status.innerText = "BYPASSING PROTOCOLS...";
        const streamUrl = `https://u-1-1azw.onrender.com/api/get-stream?title=${encodeURIComponent(title)}`;
        const streamRes = await fetch(PROXY(streamUrl));
        const streamData = await streamRes.json();

        if(!streamData.m3u8_url) throw new Error("Stream Link Not Found");

        // Fetch Subtitles
        status.innerText = "SYNCING SUBTITLES...";
        let subPath = `https://sub.wyzie.ru/search?id=${id}`;
        if(type === 'tv') subPath += `&season=${s}&episode=${e}`;
        const subs = await fetch(PROXY(subPath)).then(r => r.json()).catch(() => []);

        initPlayerCore(PROXY(streamData.m3u8_url), subs);

    } catch (err) {
        loader.style.display = 'none';
        alert("CRITICAL ERROR: " + err.message);
    }
}

/** 4. OG Subtitle Parser Logic **/
function parseVTT(text) {
    const cues = [];
    const vtt = text.replace(/^WEBVTT\s+/i, '').trim();
    const blocks = vtt.split(/\n\n+/);
    
    blocks.forEach(block => {
        const lines = block.split('\n');
        const tLine = lines.find(l => l.includes('-->'));
        if (tLine) {
            const times = tLine.split('-->');
            const start = parseTime(times[0]);
            const end = parseTime(times[1]);
            const content = lines.slice(lines.indexOf(tLine) + 1).join('\n');
            cues.push({ start, end, content });
        }
    });
    return cues;
}

function parseTime(str) {
    const p = str.trim().replace(',', '.').split(':');
    let h=0, m=0, s=0;
    if(p.length === 3) { h=p[0]; m=p[1]; s=p[2]; } else { m=p[0]; s=p[1]; }
    return (+h)*3600 + (+m)*60 + parseFloat(s);
}

/** 5. Artplayer Core Initialization **/
function initPlayerCore(videoUrl, subtitleData) {
    document.getElementById('player-wrapper').style.display = 'block';

    art = new Artplayer({
        container: '#artplayer',
        url: videoUrl,
        type: 'm3u8',
        autoplay: true,
        fullscreen: true,
        theme: '#e50914',
        setting: true,
        playbackRate: true,
        aspectRatio: true,
        hotkey: true,
        pip: true,
        customType: {
            m3u8: function(video, url) {
                if (Hls.isSupported()) {
                    const hls = new Hls();
                    hls.loadSource(url);
                    hls.attachMedia(video);
                    hls.on(Hls.Events.MANIFEST_PARSED, () => {
                        art.setting.add({
                            name: 'quality',
                            html: 'Quality',
                            selector: [
                                { html: 'Auto', level: -1, default: true },
                                ...hls.levels.map((l, i) => ({ html: l.height + 'p', level: i }))
                            ],
                            onSelect: (item) => {
                                hls.currentLevel = item.level;
                                return item.html;
                            }
                        });
                    });
                }
            }
        }
    });

    // FIX: LOADING LAYER DESTRUCTION
    art.on('video:playing', () => {
        const loader = document.getElementById('loading-overlay');
        if(loader) {
            loader.style.opacity = '0';
            setTimeout(() => { loader.style.display = 'none'; loader.style.opacity = '1'; }, 500);
        }
    });

    art.on('ready', () => {
        // Icon Sync
        const pBtn = document.getElementById('c-play');
        const sBtn = document.getElementById('c-pause');
        art.on('play', () => { pBtn.style.display='none'; sBtn.style.display='block'; });
        art.on('pause', () => { pBtn.style.display='block'; sBtn.style.display='none'; });

        // Add Subs Menu
        if(subtitleData.length > 0) {
            art.setting.add({
                name: 'subtitle',
                html: 'Subtitles',
                selector: [
                    { html: 'Off', url: null, default: true },
                    ...subtitleData.map(s => ({ html: s.lang || s.language, url: PROXY(s.url) }))
                ],
                onSelect: async (item) => {
                    if(!item.url) { 
                        subtitleCues = []; 
                        document.getElementById('sub-display').style.display='none';
                        return 'Off'; 
                    }
                    const text = await fetch(item.url).then(r => r.text());
                    subtitleCues = parseVTT(text);
                    document.getElementById('sub-display').style.display='block';
                    return item.html;
                }
            });
        }
    });

    art.on('video:timeupdate', () => {
        if(subtitleCues.length > 0) {
            const now = art.currentTime;
            const cue = subtitleCues.find(c => now >= c.start && now <= c.end);
            const subBox = document.getElementById('sub-display');
            if(cue) {
                if(cue !== activeCue) {
                    subBox.innerHTML = cue.content.replace(/\n/g, '<br>');
                    activeCue = cue;
                }
            } else {
                subBox.innerHTML = "";
                activeCue = null;
            }
        }
    });
}
</script>
</body>
</html>
