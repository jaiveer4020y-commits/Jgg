<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CINEMA ENGINE FINAL</title>
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">

<link rel="stylesheet" href="https://unpkg.com/artplayer@5.3.0/dist/artplayer.css">
<script src="https://unpkg.com/hls.js@1.5.17"></script>
<script src="https://unpkg.com/artplayer@5.3.0/dist/artplayer.js"></script>

<style>
html,body{
    margin:0;
    background:#000;
    color:#fff;
    height:100%;
    overflow:hidden;
    font-family:Inter,system-ui;
}

/* ARTPLAYER FIXES */
.art-loading-icon,
.art-subtitle{
    display:none !important;
}

/* NETFLIX LOADER */
#nf-loader{
    position:absolute;
    inset:0;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    background:#000;
    z-index:9999;
}
#nf-loader img{
    width:96px;
    animation:spin 1.1s steps(12) infinite;
}
#nf-loader span{
    margin-top:20px;
    color:#e50914;
    letter-spacing:2px;
    font-weight:700;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* SUBTITLE OVERLAY */
#subtitle-layer{
    position:absolute;
    bottom:12%;
    width:100%;
    display:flex;
    justify-content:center;
    pointer-events:none;
    z-index:9000;
}
#subtitle-text{
    max-width:90%;
    text-align:center;
    font-size:22px;
    line-height:1.4;
    padding:6px 18px;
    color:#fff;
    text-shadow:
        0 2px 4px #000,
        0 0 10px #000;
}

/* NETFLIX CONTROLS */
#nf-controls{
    position:absolute;
    inset:0;
    display:flex;
    justify-content:center;
    align-items:center;
    gap:80px;
    opacity:0;
    transition:.3s;
    z-index:8000;
}
.nf-btn{
    width:90px;height:90px;
    border-radius:50%;
    background:rgba(0,0,0,.55);
    border:1px solid rgba(255,255,255,.2);
    display:flex;
    justify-content:center;
    align-items:center;
}
.nf-btn svg{width:40px;fill:#fff}

/* SHOW CONTROLS */
.show-controls #nf-controls{opacity:1}
</style>
</head>

<body>

<div id="player"></div>

<div id="nf-loader">
    <img src="https://assets.nflxext.com/en_us/pages/wiplayer/site-spinner.png">
    <span>HANDSHAKING WITH SERVERSâ€¦</span>
</div>

<div id="subtitle-layer"><div id="subtitle-text"></div></div>

<div id="nf-controls">
    <div class="nf-btn" onclick="art.currentTime-=10">
        <svg viewBox="0 0 24 24"><path d="M11 18V6l-8.5 6z"/></svg>
    </div>
    <div class="nf-btn" onclick="art.toggle()">
        <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
    </div>
    <div class="nf-btn" onclick="art.currentTime+=10">
        <svg viewBox="0 0 24 24"><path d="M4 6v12l8.5-6z"/></svg>
    </div>
</div>

<script>
const PROXY = u=>`https://workingg.vercel.app/api/proxy?url=${encodeURIComponent(u)}`;
let art,subs=[],subDelay=0;

/* VTT PARSER */
function parseVTT(v){
    const cues=[];
    v.split(/\n\n+/).forEach(b=>{
        const l=b.split('\n');
        const t=l.find(x=>x.includes('-->'));
        if(!t) return;
        const i=l.indexOf(t);
        const [s,e]=t.split('-->');
        cues.push({
            s:time(s),
            e:time(e),
            t:l.slice(i+1).join('<br>')
        });
    });
    return cues;
}
function time(t){
    const p=t.trim().split(':');
    return (p.length===3?+p[0]*3600:0)+(+p[p.length-2]*60)+parseFloat(p[p.length-1]);
}

/* PLAYER */
art=new Artplayer({
    container:'#player',
    autoplay:true,
    fullscreen:true,
    setting:true,
    lock:true,
    autoOrientation:true,
    customType:{
        m3u8:(v,u)=>{
            const h=new Hls();
            h.loadSource(u);
            h.attachMedia(v);

            h.on(Hls.Events.MANIFEST_PARSED,()=>{
                document.getElementById('nf-loader').style.display='none';

                /* QUALITY */
                art.setting.add({
                    name:'quality',
                    html:'Quality',
                    selector:[{html:'Auto',level:-1,default:true}]
                        .concat(h.levels.map((l,i)=>({html:l.height+'p',level:i}))),
                    onSelect:i=>{h.currentLevel=i.level;return i.html}
                });

                /* AUDIO */
                if(h.audioTracks.length){
                    art.setting.add({
                        name:'audio',
                        html:'Audio',
                        selector:h.audioTracks.map((a,i)=>({
                            html:a.name||a.lang||`Track ${i+1}`,i
                        })),
                        onSelect:x=>{h.audioTrack=x.i;return x.html}
                    });
                }
            });
        }
    },
    url:PROXY('YOUR_M3U8_URL_HERE')
});

/* SUBTITLES LOAD */
fetch(PROXY('YOUR_VTT_URL_HERE'))
.then(r=>r.text())
.then(t=>subs=parseVTT(t));

/* SUB RENDER */
art.on('video:timeupdate',()=>{
    const t=art.currentTime+subDelay;
    const c=subs.find(x=>t>=x.s&&t<=x.e);
    document.getElementById('subtitle-text').innerHTML=c?c.t:'';
});

/* CONTROLS AUTO HIDE */
let hideTimer;
function showControls(){
    document.body.classList.add('show-controls');
    clearTimeout(hideTimer);
    hideTimer=setTimeout(()=>document.body.classList.remove('show-controls'),3000);
}
document.addEventListener('mousemove',showControls);
document.addEventListener('touchstart',showControls);
</script>

</body>
</html>
