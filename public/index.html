<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Netflix Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
    margin: 0;
    background: #000;
    font-family: Helvetica, Arial, sans-serif;
}

.artplayer-app {
    width: 100%;
    max-width: 960px;
    height: 540px;
    margin: 40px auto;
    background: #000;
    position: relative;
}

/* Overlay buttons */
.netflix-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 80px;
    z-index: 50;
    opacity: 1;
    pointer-events: none;
}

.netflix-btn {
    pointer-events: auto;
    cursor: pointer;
}

.netflix-btn img {
    width: 60px;
    height: 60px;
    filter: drop-shadow(0 0 8px rgba(0,0,0,.8));
}

.netflix-btn.play img {
    width: 96px;
    height: 96px;
}

/* Subtitle style */
.art-subtitle {
    font-size: 22px !important;
    background: rgba(0,0,0,.6) !important;
    padding: 4px 10px;
    border-radius: 3px;
}

/* Netflix spinner */
.netflix-spinner {
    width: 60px;
    height: 60px;
    animation: spin 1.1s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0); }
    to { transform: rotate(360deg); }
}
</style>
</head>

<body>

<div class="artplayer-app"></div>

<script src="https://cdn.jsdelivr.net/npm/@swarmcloud/hls/hls.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/artplayer@5.0.9/dist/artplayer.js"></script>

<script>
(async () => {

const qs = new URLSearchParams(location.search);
const title = qs.get('title');
const imdb = qs.get('imdb');
const season = qs.get('season');
const episode = qs.get('episode');

if (!title) return;

const proxy = u =>
 'https://workingg.vercel.app/api/proxy?url=' + encodeURIComponent(u);

/* ðŸ”¹ FETCH STREAM */
const streamRes = await fetch(
 proxy(`https://u-1-1azw.onrender.com/api/get-stream?title=${title}`)
);
const stream = await streamRes.json();
if (!stream.m3u8_url) return;

const m3u8 = proxy(stream.m3u8_url);

/* ðŸ”¹ FETCH SUBS */
let subs = [];
if (imdb) {
    const subApi = season && episode
      ? `https://sub.wyzie.ru/search?id=${imdb}&season=${season}&episode=${episode}`
      : `https://sub.wyzie.ru/search?id=${imdb}`;

    try {
        const s = await fetch(proxy(subApi));
        subs = await s.json();
    } catch {}
}

/* ðŸ”¹ ICONS */
const ICON = {
 back: 'https://rivestream.org/images/player/backward.svg',
 play: 'https://rivestream.org/images/player/play.svg',
 forward: 'https://rivestream.org/images/player/forward.svg'
};

/* ðŸ”¹ PLAYER */
const art = new Artplayer({
 container: '.artplayer-app',
 url: m3u8,
 type: 'm3u8',
 autoplay: true,
 fullscreen: true,
 fullscreenWeb: true,
 setting: true,
 playbackRate: true,
 aspectRatio: true,
 pip: true,
 airplay: true,
 playsInline: true,
 theme: '#e50914',

 subtitle: {
     visible: true,
     style: { fontSize: '22px' }
 },

 icons: {
   loading:
    '<img class="netflix-spinner" src="https://assets.nflxext.com/en_us/pages/wiplayer/site-spinner.png">'
 },

 layers: [{
   name: 'netflix-ui',
   html: `
   <div class="netflix-overlay">
     <div class="netflix-btn back"><img src="${ICON.back}"></div>
     <div class="netflix-btn play"><img src="${ICON.play}"></div>
     <div class="netflix-btn forward"><img src="${ICON.forward}"></div>
   </div>`
 }],

 customType: {
  m3u8(video, url, art) {
   if (Hls.isSupported()) {
    const hls = new Hls({
      enableWorker: true,
      maxBufferLength: 40,
      fragLoadingMaxRetry: 3,
      levelLoadingMaxRetry: 3,
      manifestLoadingMaxRetry: 2
    });
    hls.loadSource(url);
    hls.attachMedia(video);
    art.hls = hls;

    hls.on(Hls.Events.MANIFEST_PARSED, () => {
      art.setting.add({
        name: 'quality',
        html: 'Quality',
        selector: [
          { html: 'Auto', level: -1, default: true },
          ...hls.levels.map((l, i) => ({
            html: l.height + 'p',
            level: i
          }))
        ],
        onSelect: i => {
          hls.currentLevel = i.level;
          return i.html;
        }
      });
    });
   }
  }
 }
});

/* ðŸ”¹ SUBTITLE MENU */
if (subs.length) {
 art.setting.add({
   name: 'subtitle',
   html: 'Subtitles',
   selector: [
     { html: 'Off', url: '', default: true },
     ...subs.map(s => ({
       html: s.lang || s.language || 'Subtitle',
       url: proxy(s.url)
     }))
   ],
   onSelect: i => {
     art.subtitle.url = i.url;
     art.subtitle.visible = !!i.url;
     return i.html;
   }
 });
}

/* ðŸ”¹ BUTTON ACTIONS */
art.on('ready', () => {
 const play = document.querySelector('.netflix-btn.play');
 const back = document.querySelector('.netflix-btn.back');
 const forward = document.querySelector('.netflix-btn.forward');

 play.onclick = () => art.toggle();
 back.onclick = () => art.seek = art.currentTime - 10;
 forward.onclick = () => art.seek = art.currentTime + 10;
});

})();
</script>
</body>
</html>
