<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Netflix Pro - Master Engine</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@swarmcloud/hls/hls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/artplayer@5.0.9/dist/artplayer.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --n-red: #E50914;
            --n-black: #000000;
            --font-stack: 'Netflix Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background-color: var(--n-black);
            font-family: var(--font-stack);
            overflow: hidden; color: white;
        }

        /* --- 1. HIGH-RES LOADING LAYER --- */
        #loader-layer {
            position: fixed; inset: 0; z-index: 9999;
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.5s ease-out;
        }
        /* Dark Gradient Overlay for text readability */
        #loader-layer::before {
            content: ''; position: absolute; inset: 0;
            background: radial-gradient(circle, rgba(0,0,0,0.4) 0%, rgba(0,0,0,0.95) 100%);
        }
        
        .loader-content { position: relative; z-index: 2; text-align: center; width: 80%; }
        
        #exclusive-tag {
            color: var(--n-red); font-weight: 800; letter-spacing: 4px; font-size: 14px;
            margin-bottom: 10px; text-transform: uppercase; text-shadow: 0 2px 10px rgba(0,0,0,0.8);
        }
        
        #loader-title {
            font-size: 4vw; font-weight: 900; margin: 0 0 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8); line-height: 1.1;
        }

        /* OG RED SPINNER */
        .n-spinner-box { width: 50px; height: 50px; position: relative; margin: 0 auto; }
        .n-spinner {
            width: 100%; height: 100%;
            border: 4px solid transparent;
            border-top-color: var(--n-red);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        .n-spinner::before {
            content: ''; position: absolute; top: 12px; right: 12px; bottom: 12px; left: 12px;
            border: 4px solid transparent;
            border-top-color: #b81d24;
            border-radius: 50%;
            animation: spin 0.5s linear infinite reverse;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- 2. PLAYER UI --- */
        #app { width: 100%; height: 100vh; position: relative; }
        .artplayer-app { width: 100%; height: 100%; }

        /* Header */
        .nf-header {
            position: absolute; top: 0; left: 0; right: 0; height: 100px;
            background: linear-gradient(180deg, rgba(0,0,0,0.9) 0%, transparent 100%);
            z-index: 90; display: flex; align-items: center; padding: 0 4%; gap: 20px;
            opacity: 0; transition: opacity 0.3s;
        }
        .art-state-show .nf-header { opacity: 1; }
        .back-icon { cursor: pointer; font-size: 32px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5)); transition: 0.2s; }
        .back-icon:hover { transform: scale(1.1); color: var(--n-red); }

        /* --- 3. CUSTOM CENTER CONTROLS (YOUR ICONS) --- */
        .mobileCenterControls_overlayContainer__sDIgn {
            position: absolute; inset: 0; z-index: 50;
            display: flex; align-items: center; justify-content: center;
            pointer-events: none; opacity: 0; transition: opacity 0.3s;
        }
        .art-state-show .mobileCenterControls_overlayContainer__sDIgn { opacity: 1; }
        
        .mobileCenterControls_playerControlsContainer__7aONH { pointer-events: auto; }
        .mobileCenterControls_playerControlsInnerContainer__6MCmU {
            display: flex; align-items: center; gap: 40px; /* Space between icons */
        }
        
        .videasy-scale {
            background: none; border: none; cursor: pointer; padding: 0; color: white;
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex; align-items: center; justify-content: center;
            filter: drop-shadow(0 0 10px rgba(0,0,0,0.8));
        }
        .videasy-scale:hover { transform: scale(1.2); }
        .videasy-scale:active { transform: scale(0.9); }
        
        .videasy-icon-lg { width: 60px; height: 60px; }
        #ButtonPlay svg { width: 90px; height: 90px; } /* Play button larger */

        /* --- 4. SUBTITLE & SETTINGS STYLING --- */
        .art-subtitle {
            bottom: 60px !important; /* Move up from bottom bar */
            font-size: 32px !important;
            font-weight: bold !important;
            text-shadow: 0 0 5px black, 0 0 5px black, 0 0 5px black !important;
            color: #fff !important;
        }
        /* Custom Red Theme elements */
        .art-progress-played { background: var(--n-red) !important; }
        .art-progress-indicator { background: var(--n-red) !important; border: 2px solid white; }
    </style>
</head>
<body>

    <div id="loader-layer">
        <div class="loader-content">
            <div id="exclusive-tag">NETFLIX EXCLUSIVE</div>
            <h1 id="loader-title">INITIALIZING STREAM...</h1>
            <div class="n-spinner-box">
                <div class="n-spinner"></div>
            </div>
            <p id="loader-meta" style="color:#ccc; margin-top:15px; font-size:14px; letter-spacing:1px;">Establishing Secure Connection...</p>
        </div>
    </div>

    <div id="app">
        <div class="artplayer-app"></div>
        
        <div class="nf-header">
            <i class="fas fa-arrow-left back-icon" onclick="window.history.back()"></i>
            <div>
                <div style="font-size:18px; font-weight:bold;" id="header-title">Loading...</div>
                <div style="font-size:13px; color:#ddd;" id="header-slug">S-- E--</div>
            </div>
        </div>

        </div>

<script>
    /**
     * GOD-TIER CONFIGURATION
     */
    const CONFIG = {
        tmdbKey: 'a872655d4924c5850907f1f7d5494d6a',
        proxy: 'https://workingg.vercel.app/api/proxy?url=',
        // Your specific M3U8 source
        streamUrl: 'https://185.237.106.169/v4/Lis-38MjEgUbLsw9uh2SEQ/1767968654/is3/fdtaux/master.m3u8'
    };

    let art = null;
    let meta = { title: '', season: '', episode: '', isSeries: false, tmdbId: '' };

    // --- 1. THE SLUG DOCTOR (Fixes the duplication bug) ---
    function parseSlug() {
        const params = new URLSearchParams(window.location.search);
        let rawTitle = params.get('title') || '';
        meta.tmdbId = params.get('id');
        
        // Regex to find "s01e01" pattern
        const seasonMatch = rawTitle.match(/s(\d+)e(\d+)/i);
        
        if (seasonMatch) {
            meta.isSeries = true;
            meta.season = parseInt(seasonMatch[1]);
            meta.episode = parseInt(seasonMatch[2]);
            
            // CLEAN THE TITLE: Remove "s01e01" and dots
            let cleanName = rawTitle.replace(/s\d+e\d+.*/i, '') // Remove everything after s01e01
                                    .replace(/\./g, ' ')        // Replace dots with spaces
                                    .trim();
            meta.title = cleanName.toUpperCase();
        } else {
            // It's a movie or malformed
            meta.title = rawTitle.replace(/\./g, ' ').toUpperCase();
        }
        
        // Override with direct params if available
        if(params.get('season')) { meta.season = params.get('season'); meta.isSeries = true; }
        if(params.get('episode')) { meta.episode = params.get('episode'); meta.isSeries = true; }
    }

    // --- 2. METADATA ENGINE (High Res Images) ---
    async function fetchMetadata() {
        if (!meta.tmdbId) return;
        
        try {
            const type = meta.isSeries ? 'tv' : 'movie';
            const url = `https://api.themoviedb.org/3/${type}/${meta.tmdbId}?api_key=${CONFIG.tmdbKey}`;
            const res = await fetch(url);
            const data = await res.json();

            // 1. Set High-Res Background (Original size)
            if (data.backdrop_path) {
                const bgUrl = `https://image.tmdb.org/t/p/original${data.backdrop_path}`;
                document.getElementById('loader-layer').style.backgroundImage = `url(${bgUrl})`;
            }

            // 2. Set Text
            const realTitle = data.title || data.name;
            document.getElementById('loader-title').innerText = realTitle;
            document.getElementById('header-title').innerText = realTitle;
            
            if (meta.isSeries) {
                const epSlug = `SEASON ${meta.season} : EPISODE ${meta.episode}`;
                document.getElementById('exclusive-tag').innerText = epSlug;
                document.getElementById('header-slug').innerText = epSlug;
            } else {
                document.getElementById('exclusive-tag').innerText = "MOVIE EXCLUSIVE";
                document.getElementById('header-slug').innerText = data.release_date ? data.release_date.split('-')[0] : 'Feature Film';
            }

        } catch (e) {
            console.error("Meta Fetch Fail", e);
        }
    }

    // --- 3. INIT PLAYER ---
    function initPlayer() {
        const fullProxyUrl = CONFIG.proxy + encodeURIComponent(CONFIG.streamUrl + `?v=${Date.now()}`);

        art = new Artplayer({
            container: '.artplayer-app',
            url: fullProxyUrl,
            type: 'm3u8',
            theme: '#E50914',
            autoSize: false,
            fullscreen: true,
            fullscreenWeb: true,
            setting: true,
            playbackRate: true,
            aspectRatio: true,
            pip: true,
            lock: true,
            fastForward: true, // Mobile long-press
            autoOrientation: true,
            
            // Inject Your Custom Icons into a Layer
            layers: [
                {
                    name: 'custom-controls',
                    html: `
                        <div class="mobileCenterControls_overlayContainer__sDIgn">
                            <div class="mobileCenterControls_playerControlsContainer__7aONH">
                                <div class="mobileCenterControls_playerControlsInnerContainer__6MCmU">
                                    <button id="btn-back" class="videasy-scale" data-tooltip="Backward 10s">
                                        <svg viewBox="0 0 24 24" fill="none" class="videasy-icon-lg"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.02 2.048A10 10 0 1 1 2 12H0a12 12 0 1 0 5-9.747V1H3v4a1 1 0 0 0 1 1h4V4H6a10 10 0 0 1 5.02-1.952ZM2 4v3h3v2H1a1 1 0 0 1-1-1V4h2Zm12.125 12c-.578 0-1.086-.141-1.523-.424-.43-.29-.764-.694-.999-1.215-.235-.527-.353-1.148-.353-1.861 0-.707.118-1.324.353-1.851.236-.527.568-.932.999-1.215.437-.29.945-.434 1.523-.434s1.083.145 1.513.434c.437.283.774.688 1.009 1.215.235.527.353 1.144.353 1.851 0 .713-.118 1.334-.353 1.86-.235.522-.572.927-1.009 1.216-.43.283-.935.424-1.513.424Zm0-1.35c.39 0 .696-.186.918-.56.222-.378.333-.909.333-1.59s-.111-1.208-.333-1.581c-.222-.38-.528-.57-.918-.57s-.696.19-.918.57c-.222.373-.333.9-.333 1.581 0 .681.111 1.212.333 1.59.222.374.528.56.918.56Zm-5.521 1.205v-5.139L7 11.141V9.82l3.198-.8v6.835H8.604Z" fill="currentColor"></path></svg>
                                    </button>
                                    <button id="btn-play" class="videasy-scale">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 384 512" class="videasy-icon-lg" style="transform: translateX(5%);"><path fill="currentColor" d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"></path></svg>
                                    </button>
                                    <button id="btn-fwd" class="videasy-scale" data-tooltip="Forward 10s">
                                        <svg viewBox="0 0 24 24" fill="none" class="videasy-icon-lg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.444 3.685A10 10 0 0 1 18 4h-2v2h4a1 1 0 0 0 1-1V1h-2v1.253A12 12 0 1 0 24 12h-2A10 10 0 1 1 6.444 3.685ZM22 4v3h-3v2h4a1 1 0 0 0 1-1V4h-2Zm-9.398 11.576c.437.283.945.424 1.523.424s1.083-.141 1.513-.424c.437-.29.774-.694 1.009-1.215.235-.527.353-1.148.353-1.861 0-.707-.118-1.324-.353-1.851-.235-.527-.572-.932-1.009-1.215-.43-.29-.935-.434-1.513-.434-.578 0-1.086.145-1.523.434-.43.283-.764.688-.999 1.215-.235.527-.353 1.144-.353 1.851 0 .713.118 1.334.353 1.86.236.522.568.927.999 1.216Zm2.441-1.485c-.222.373-.528.56-.918.56s-.696-.187-.918-.56c-.222-.38-.333-.91-.333-1.591 0-.681.111-1.208.333-1.581.222-.38.528-.57.918-.57s.696.19.918.57c.222.373.333.9.333 1.581 0 .681-.111 1.212-.333 1.59Zm-6.439-3.375v5.14h1.594V9.018L7 9.82v1.321l1.604-.424Z" fill="currentColor"></path></svg>
                                    </button>
                                </div>
                            </div>
                        </div>`,
                }
            ],

            customType: {
                m3u8: function (video, url, art) {
                    if (Hls.isSupported()) {
                        const hls = new Hls();
                        hls.loadSource(url);
                        hls.attachMedia(video);
                        art.hls = hls;

                        hls.on(Hls.Events.MANIFEST_PARSED, () => {
                            // 1. QUALITY SWITCHER
                            art.setting.add({
                                name: 'quality',
                                html: 'Quality',
                                selector: [
                                    { default: true, html: 'Auto', level: -1 },
                                    ...hls.levels.map((l, i) => ({ html: l.height + 'p', level: i }))
                                ],
                                onSelect: (item) => {
                                    hls.currentLevel = item.level;
                                    return item.html;
                                }
                            });

                            // 2. AUDIO SWITCHER (If stream has multiple audio)
                            if (hls.audioTracks.length > 0) {
                                art.setting.add({
                                    name: 'audio',
                                    html: 'Audio',
                                    selector: hls.audioTracks.map((t, i) => ({
                                        html: t.name || `Language ${i+1}`,
                                        index: i
                                    })),
                                    onSelect: (item) => {
                                        hls.audioTrack = item.index;
                                        return item.html;
                                    }
                                });
                            }

                            // 3. FADE OUT LOADER
                            const loader = document.getElementById('loader-layer');
                            loader.style.opacity = '0';
                            setTimeout(() => loader.style.display = 'none', 500);
                        });
                    }
                }
            },
            // Replace default loader with nothing (we use our own overlay)
            icons: {
                loading: '<div style="display:none"></div>',
                state: '<div style="display:none"></div>' // Hide default center play
            },
            // ADVANCED SETTINGS (Subtitle Logic)
            settings: [
                {
                    html: 'Subtitle Config',
                    icon: '<i class="fas fa-closed-captioning"></i>',
                    selector: [
                        { html: 'Import Sub (URL)', action: 'url' },
                        { html: 'Sync Delay (+0.5s)', action: 'delay_p' },
                        { html: 'Sync Delay (-0.5s)', action: 'delay_m' },
                    ],
                    onSelect: (item) => {
                        if (item.action === 'url') {
                            const url = prompt("Enter Subtitle URL:");
                            if(url) art.subtitle.url = CONFIG.proxy + encodeURIComponent(url);
                        } else if (item.action === 'delay_p') {
                            art.subtitle.offset += 0.5;
                            art.notice.show = `Offset: ${art.subtitle.offset}s`;
                        } else if (item.action === 'delay_m') {
                            art.subtitle.offset -= 0.5;
                            art.notice.show = `Offset: ${art.subtitle.offset}s`;
                        }
                        return 'Subtitle Config';
                    }
                }
            ]
        });

        // --- 4. BIND CUSTOM ICONS TO EVENTS ---
        art.on('ready', () => {
            const btnBack = document.getElementById('btn-back');
            const btnPlay = document.getElementById('btn-play');
            const btnFwd = document.getElementById('btn-fwd');
            
            // Icon SVGs
            const playPath = `<path fill="currentColor" d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"></path>`;
            const pausePath = `<path fill="currentColor" d="M144 479H48c-26.5 0-48-21.5-48-48V79c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48zm304-48V79c0-26.5-21.5-48-48-48h-96c-26.5 0-48 21.5-48 48v352c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48z"/>`;

            btnBack.onclick = () => art.currentTime -= 10;
            btnFwd.onclick = () => art.currentTime += 10;
            btnPlay.onclick = () => art.toggle();

            art.on('play', () => {
                btnPlay.querySelector('svg').innerHTML = pausePath;
                btnPlay.querySelector('svg').setAttribute('viewBox', '0 0 448 512'); // Adjust viewBox for pause icon
            });
            
            art.on('pause', () => {
                btnPlay.querySelector('svg').innerHTML = playPath;
                btnPlay.querySelector('svg').setAttribute('viewBox', '0 0 384 512'); // Return to play viewBox
            });
        });
    }

    // --- LAUNCH SEQUENCE ---
    window.onload = async () => {
        parseSlug();
        await fetchMetadata();
        initPlayer();
    };

</script>
</body>
</html>
